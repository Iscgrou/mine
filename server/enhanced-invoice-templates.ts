/**
 * Enhanced Invoice Template System with Distinct Styling Algorithms
 * Three completely different approaches for invoice generation
 */

interface TemplateConfig {
  name: string;
  algorithm: string;
  colors: {
    primary: string;
    secondary: string;
    accent: string;
    background: string;
    text: string;
  };
  typography: {
    primary: string;
    secondary: string;
    size: string;
  };
  layout: {
    structure: string;
    spacing: string;
    borders: string;
  };
}

class EnhancedInvoiceTemplates {
  private readonly TEMPLATE_CONFIGS: Record<string, TemplateConfig> = {
    'modern_clean': {
      name: 'ŸÖÿØÿ±ŸÜ Ÿà Ÿæÿß⁄©',
      algorithm: 'minimalist_geometry',
      colors: {
        primary: '#4f46e5',
        secondary: '#e5e7eb', 
        accent: '#10b981',
        background: '#ffffff',
        text: '#111827'
      },
      typography: {
        primary: 'IRANSans',
        secondary: 'Vazirmatn',
        size: 'responsive'
      },
      layout: {
        structure: 'grid_based',
        spacing: 'generous',
        borders: 'subtle_shadows'
      }
    },
    'classic_formal': {
      name: '⁄©ŸÑÿßÿ≥€å⁄© Ÿà ÿ±ÿ≥ŸÖ€å',
      algorithm: 'traditional_borders',
      colors: {
        primary: '#1f2937',
        secondary: '#f3f4f6',
        accent: '#d97706',
        background: '#fefefe',
        text: '#374151'
      },
      typography: {
        primary: 'Vazir',
        secondary: 'Tahoma',
        size: 'fixed'
      },
      layout: {
        structure: 'table_based',
        spacing: 'compact',
        borders: 'formal_lines'
      }
    },
    'persian_optimized': {
      name: 'ÿ®Ÿá€åŸÜŸá ÿ¥ÿØŸá ŸÅÿßÿ±ÿ≥€å',
      algorithm: 'calligraphy_enhanced',
      colors: {
        primary: '#059669',
        secondary: '#f0fdf4',
        accent: '#dc2626',
        background: '#fcfdf7',
        text: '#064e3b'
      },
      typography: {
        primary: 'Sahel',
        secondary: 'Samim',
        size: 'large'
      },
      layout: {
        structure: 'artistic_flow',
        spacing: 'balanced',
        borders: 'decorative'
      }
    }
  };

  /**
   * Algorithm 1: Minimalist Geometry (Modern Clean)
   * Uses geometric shapes, clean lines, and modern spacing
   */
  private generateModernCleanTemplate(invoiceData: any): string {
    const config = this.TEMPLATE_CONFIGS['modern_clean'];
    
    return `
    <!DOCTYPE html>
    <html lang="fa" dir="rtl">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ŸÅÿß⁄©ÿ™Ÿàÿ± ${invoiceData.invoiceNumber}</title>
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
            @import url('https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css');
            
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            
            body {
                font-family: 'Vazirmatn', -apple-system, BlinkMacSystemFont, sans-serif;
                background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
                min-height: 100vh;
                padding: 2rem;
                color: ${config.colors.text};
            }
            
            .invoice-container {
                max-width: 800px;
                margin: 0 auto;
                background: ${config.colors.background};
                border-radius: 20px;
                box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
                overflow: hidden;
                position: relative;
            }
            
            .header-section {
                background: linear-gradient(135deg, ${config.colors.primary} 0%, #6366f1 100%);
                padding: 3rem 2rem;
                position: relative;
                overflow: hidden;
            }
            
            .header-section::before {
                content: '';
                position: absolute;
                top: -50%;
                right: -20%;
                width: 200px;
                height: 200px;
                background: rgba(255,255,255,0.1);
                border-radius: 50%;
                transform: rotate(45deg);
            }
            
            .header-section::after {
                content: '';
                position: absolute;
                bottom: -30%;
                left: -10%;
                width: 150px;
                height: 150px;
                background: rgba(255,255,255,0.05);
                clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
            }
            
            .company-info {
                color: white;
                position: relative;
                z-index: 2;
            }
            
            .company-name {
                font-size: 2.5rem;
                font-weight: 700;
                margin-bottom: 0.5rem;
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            
            .company-slogan {
                font-size: 1.1rem;
                opacity: 0.9;
                font-weight: 300;
            }
            
            .invoice-meta {
                position: absolute;
                top: 3rem;
                left: 2rem;
                color: white;
                text-align: left;
                z-index: 2;
            }
            
            .invoice-number {
                font-size: 1.5rem;
                font-weight: 600;
                margin-bottom: 0.5rem;
            }
            
            .invoice-date {
                font-size: 1rem;
                opacity: 0.8;
            }
            
            .content-section {
                padding: 2.5rem;
            }
            
            .customer-info {
                background: ${config.colors.secondary};
                border-radius: 15px;
                padding: 2rem;
                margin-bottom: 2rem;
                border-right: 4px solid ${config.colors.accent};
            }
            
            .customer-title {
                font-size: 1.3rem;
                font-weight: 600;
                color: ${config.colors.primary};
                margin-bottom: 1rem;
                display: flex;
                align-items: center;
            }
            
            .customer-title::before {
                content: 'üë§';
                margin-left: 0.5rem;
                font-size: 1.2rem;
            }
            
            .items-table {
                border-radius: 15px;
                overflow: hidden;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                margin-bottom: 2rem;
            }
            
            .table-header {
                background: linear-gradient(135deg, ${config.colors.primary} 0%, #6366f1 100%);
                color: white;
                padding: 1.5rem;
                display: grid;
                grid-template-columns: 3fr 1fr 1fr 1fr;
                gap: 1rem;
                font-weight: 600;
            }
            
            .table-row {
                background: white;
                padding: 1.5rem;
                display: grid;
                grid-template-columns: 3fr 1fr 1fr 1fr;
                gap: 1rem;
                border-bottom: 1px solid ${config.colors.secondary};
                transition: background-color 0.2s;
            }
            
            .table-row:hover {
                background: ${config.colors.secondary};
            }
            
            .table-row:last-child {
                border-bottom: none;
            }
            
            .total-section {
                background: linear-gradient(135deg, ${config.colors.accent} 0%, #059669 100%);
                color: white;
                padding: 2rem;
                border-radius: 15px;
                margin-bottom: 2rem;
                text-align: center;
            }
            
            .total-amount {
                font-size: 2.5rem;
                font-weight: 700;
                margin-bottom: 0.5rem;
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            
            .total-label {
                font-size: 1.1rem;
                opacity: 0.9;
            }
            
            .footer-section {
                background: ${config.colors.secondary};
                padding: 2rem;
                text-align: center;
                border-top: 1px solid ${config.colors.secondary};
            }
            
            .qr-code {
                width: 100px;
                height: 100px;
                background: ${config.colors.primary};
                border-radius: 10px;
                margin: 0 auto 1rem;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-weight: 600;
            }
            
            @media print {
                body { padding: 0; background: white; }
                .invoice-container { box-shadow: none; }
            }
        </style>
    </head>
    <body>
        <div class="invoice-container">
            <div class="header-section">
                <div class="company-info">
                    <div class="company-name">MarFanet</div>
                    <div class="company-slogan">ÿ¢€åŸÜÿØŸá ÿßÿ±ÿ™ÿ®ÿßÿ∑ÿßÿ™ ÿØÿ± ÿØÿ≥ÿ™ÿßŸÜ ÿ¥ŸÖÿß</div>
                </div>
                <div class="invoice-meta">
                    <div class="invoice-number">ŸÅÿß⁄©ÿ™Ÿàÿ± ${invoiceData.invoiceNumber}</div>
                    <div class="invoice-date">${this.getCurrentShamsiDate()}</div>
                </div>
            </div>
            
            <div class="content-section">
                <div class="customer-info">
                    <div class="customer-title">ÿßÿ∑ŸÑÿßÿπÿßÿ™ ŸÖÿ¥ÿ™ÿ±€å</div>
                    <div><strong>ŸÜÿßŸÖ:</strong> ${invoiceData.representative?.fullName || 'ŸÜŸÖÿß€åŸÜÿØŸá'}</div>
                    <div><strong>ÿ¥ŸÖÿßÿ±Ÿá ÿ™ŸÖÿßÿ≥:</strong> ${invoiceData.representative?.phoneNumber || 'ÿ™ÿπÿ±€åŸÅ ŸÜÿ¥ÿØŸá'}</div>
                    <div><strong>ŸÅÿ±Ÿàÿ¥⁄ØÿßŸá:</strong> ${invoiceData.representative?.storeName || 'ÿ™ÿπÿ±€åŸÅ ŸÜÿ¥ÿØŸá'}</div>
                </div>
                
                <div class="items-table">
                    <div class="table-header">
                        <div>ÿ¥ÿ±ÿ≠ ÿÆÿØŸÖÿßÿ™</div>
                        <div>ÿ™ÿπÿØÿßÿØ</div>
                        <div>ŸÇ€åŸÖÿ™ Ÿàÿßÿ≠ÿØ</div>
                        <div>ÿ¨ŸÖÿπ</div>
                    </div>
                    ${invoiceData.items.map((item: any) => `
                        <div class="table-row">
                            <div>${item.description}</div>
                            <div>${item.quantity}</div>
                            <div>${this.formatPersianNumber(item.unitPrice)} ÿ™ŸàŸÖÿßŸÜ</div>
                            <div>${this.formatPersianNumber(item.totalPrice)} ÿ™ŸàŸÖÿßŸÜ</div>
                        </div>
                    `).join('')}
                </div>
                
                <div class="total-section">
                    <div class="total-amount">${this.formatPersianNumber(invoiceData.totalAmount)} ÿ™ŸàŸÖÿßŸÜ</div>
                    <div class="total-label">ŸÖÿ®ŸÑÿ∫ ⁄©ŸÑ ŸÇÿßÿ®ŸÑ Ÿæÿ±ÿØÿßÿÆÿ™</div>
                </div>
            </div>
            
            <div class="footer-section">
                <div class="qr-code">QR</div>
                <p>⁄©ÿØ QR ÿ®ÿ±ÿß€å Ÿæÿ±ÿØÿßÿÆÿ™ ÿ≥ÿ±€åÿπ</p>
                <p style="margin-top: 1rem; font-size: 0.9rem; opacity: 0.7;">
                    ÿ™ÿ¥⁄©ÿ± ÿßÿ≤ ÿßÿπÿ™ŸÖÿßÿØ ÿ¥ŸÖÿß ÿ®Ÿá MarFanet
                </p>
            </div>
        </div>
    </body>
    </html>
    `;
  }

  /**
   * Algorithm 2: Traditional Borders (Classic Formal)
   * Uses formal table structure with classic borders and traditional spacing
   */
  private generateClassicFormalTemplate(invoiceData: any): string {
    const config = this.TEMPLATE_CONFIGS['classic_formal'];
    
    return `
    <!DOCTYPE html>
    <html lang="fa" dir="rtl">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ŸÅÿß⁄©ÿ™Ÿàÿ± ÿ±ÿ≥ŸÖ€å ${invoiceData.invoiceNumber}</title>
        <style>
            @import url('https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.css');
            
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            
            body {
                font-family: 'Vazir', Tahoma, Arial, sans-serif;
                background: ${config.colors.background};
                padding: 1.5rem;
                color: ${config.colors.text};
                line-height: 1.6;
            }
            
            .invoice-document {
                max-width: 800px;
                margin: 0 auto;
                background: white;
                border: 3px solid ${config.colors.primary};
                box-shadow: 0 0 20px rgba(0,0,0,0.1);
            }
            
            .document-header {
                border-bottom: 3px double ${config.colors.primary};
                padding: 2rem;
                background: ${config.colors.secondary};
                text-align: center;
                position: relative;
            }
            
            .document-title {
                font-size: 2.2rem;
                font-weight: bold;
                color: ${config.colors.primary};
                margin-bottom: 0.5rem;
                text-decoration: underline;
                text-decoration-color: ${config.colors.accent};
            }
            
            .company-details {
                font-size: 1.1rem;
                margin-bottom: 1rem;
                color: ${config.colors.text};
            }
            
            .invoice-info-box {
                position: absolute;
                top: 2rem;
                left: 2rem;
                border: 2px solid ${config.colors.accent};
                padding: 1rem;
                background: white;
                min-width: 200px;
            }
            
            .invoice-info-title {
                font-weight: bold;
                color: ${config.colors.primary};
                border-bottom: 1px solid ${config.colors.accent};
                padding-bottom: 0.5rem;
                margin-bottom: 0.5rem;
            }
            
            .formal-section {
                border: 2px solid ${config.colors.primary};
                margin: 1rem;
                background: white;
            }
            
            .section-header {
                background: ${config.colors.primary};
                color: white;
                padding: 1rem;
                font-weight: bold;
                font-size: 1.2rem;
                border-bottom: 2px solid ${config.colors.accent};
            }
            
            .section-content {
                padding: 1.5rem;
            }
            
            .formal-table {
                width: 100%;
                border-collapse: collapse;
                margin: 1rem 0;
                border: 2px solid ${config.colors.primary};
            }
            
            .formal-table th {
                background: ${config.colors.primary};
                color: white;
                padding: 1rem;
                border: 1px solid ${config.colors.text};
                font-weight: bold;
                text-align: center;
            }
            
            .formal-table td {
                padding: 1rem;
                border: 1px solid ${config.colors.primary};
                text-align: center;
                background: white;
            }
            
            .formal-table tr:nth-child(even) td {
                background: ${config.colors.secondary};
            }
            
            .amount-box {
                border: 3px double ${config.colors.primary};
                background: ${config.colors.secondary};
                padding: 2rem;
                margin: 1rem;
                text-align: center;
            }
            
            .amount-title {
                font-size: 1.3rem;
                font-weight: bold;
                color: ${config.colors.primary};
                margin-bottom: 1rem;
                text-decoration: underline;
            }
            
            .amount-value {
                font-size: 2rem;
                font-weight: bold;
                color: ${config.colors.accent};
                border: 2px solid ${config.colors.accent};
                padding: 1rem;
                background: white;
                display: inline-block;
                min-width: 300px;
            }
            
            .formal-footer {
                border-top: 3px double ${config.colors.primary};
                padding: 2rem;
                background: ${config.colors.secondary};
                text-align: center;
            }
            
            .signature-section {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 2rem;
                margin-top: 2rem;
            }
            
            .signature-box {
                border: 2px solid ${config.colors.primary};
                padding: 1.5rem;
                height: 120px;
                background: white;
                text-align: center;
            }
            
            .signature-title {
                font-weight: bold;
                color: ${config.colors.primary};
                border-bottom: 1px solid ${config.colors.accent};
                padding-bottom: 0.5rem;
                margin-bottom: 1rem;
            }
            
            @media print {
                body { padding: 0; }
                .invoice-document { border: 2px solid black; }
            }
        </style>
    </head>
    <body>
        <div class="invoice-document">
            <div class="document-header">
                <div class="invoice-info-box">
                    <div class="invoice-info-title">ŸÖÿ¥ÿÆÿµÿßÿ™ ŸÅÿß⁄©ÿ™Ÿàÿ±</div>
                    <div><strong>ÿ¥ŸÖÿßÿ±Ÿá:</strong> ${invoiceData.invoiceNumber}</div>
                    <div><strong>ÿ™ÿßÿ±€åÿÆ:</strong> ${this.getCurrentShamsiDate()}</div>
                    <div><strong>Ÿàÿ∂ÿπ€åÿ™:</strong> ${invoiceData.status || 'ÿµÿßÿØÿ± ÿ¥ÿØŸá'}</div>
                </div>
                
                <div class="document-title">ŸÅÿß⁄©ÿ™Ÿàÿ± ÿ±ÿ≥ŸÖ€å ŸÅÿ±Ÿàÿ¥</div>
                <div class="company-details">
                    <strong>ÿ¥ÿ±⁄©ÿ™ ŸÖÿßÿ±ŸÅÿßŸÜÿ™</strong><br>
                    ÿßÿ±ÿßÿ¶Ÿá‚ÄåÿØŸáŸÜÿØŸá ÿÆÿØŸÖÿßÿ™ ÿßÿ±ÿ™ÿ®ÿßÿ∑€å Ÿæ€åÿ¥ÿ±ŸÅÿ™Ÿá<br>
                    ÿ™ŸÑŸÅŸÜ: €∞€≤€±-€∏€∏€∑€∑€∂€∂€µ€µ | Ÿàÿ®‚Äåÿ≥ÿß€åÿ™: marfanet.ir
                </div>
            </div>
            
            <div class="formal-section">
                <div class="section-header">ÿßÿ∑ŸÑÿßÿπÿßÿ™ ÿÆÿ±€åÿØÿßÿ±</div>
                <div class="section-content">
                    <table style="width: 100%; border: none;">
                        <tr>
                            <td style="border: none; text-align: right; padding: 0.5rem;"><strong>ŸÜÿßŸÖ Ÿà ŸÜÿßŸÖ ÿÆÿßŸÜŸàÿßÿØ⁄Ø€å:</strong></td>
                            <td style="border: none; text-align: right; padding: 0.5rem;">${invoiceData.representative?.fullName || 'ŸÜŸÖÿß€åŸÜÿØŸá ŸÖÿ≠ÿ™ÿ±ŸÖ'}</td>
                            <td style="border: none; text-align: right; padding: 0.5rem;"><strong>ÿ¥ŸÖÿßÿ±Ÿá ÿ™ŸÖÿßÿ≥:</strong></td>
                            <td style="border: none; text-align: right; padding: 0.5rem;">${invoiceData.representative?.phoneNumber || 'ÿ™ÿπÿ±€åŸÅ ŸÜÿ¥ÿØŸá'}</td>
                        </tr>
                        <tr>
                            <td style="border: none; text-align: right; padding: 0.5rem;"><strong>ŸÜÿßŸÖ ŸÅÿ±Ÿàÿ¥⁄ØÿßŸá:</strong></td>
                            <td style="border: none; text-align: right; padding: 0.5rem;">${invoiceData.representative?.storeName || 'ÿ™ÿπÿ±€åŸÅ ŸÜÿ¥ÿØŸá'}</td>
                            <td style="border: none; text-align: right; padding: 0.5rem;"><strong>⁄©ÿØ ŸÜŸÖÿß€åŸÜÿØŸá:</strong></td>
                            <td style="border: none; text-align: right; padding: 0.5rem;">${invoiceData.representative?.id || 'ŸÜÿßŸÖÿ¥ÿÆÿµ'}</td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <div class="formal-section">
                <div class="section-header">ŸÖÿ¥ÿÆÿµÿßÿ™ ⁄©ÿßŸÑÿß Ÿà ÿÆÿØŸÖÿßÿ™</div>
                <div class="section-content">
                    <table class="formal-table">
                        <thead>
                            <tr>
                                <th>ÿ±ÿØ€åŸÅ</th>
                                <th>ÿ¥ÿ±ÿ≠ ⁄©ÿßŸÑÿß/ÿÆÿØŸÖÿßÿ™</th>
                                <th>ÿ™ÿπÿØÿßÿØ</th>
                                <th>ŸÇ€åŸÖÿ™ Ÿàÿßÿ≠ÿØ (ÿ™ŸàŸÖÿßŸÜ)</th>
                                <th>ŸÖÿ®ŸÑÿ∫ ⁄©ŸÑ (ÿ™ŸàŸÖÿßŸÜ)</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${invoiceData.items.map((item: any, index: number) => `
                                <tr>
                                    <td>${this.formatPersianNumber(index + 1)}</td>
                                    <td>${item.description}</td>
                                    <td>${this.formatPersianNumber(item.quantity)}</td>
                                    <td>${this.formatPersianNumber(item.unitPrice)}</td>
                                    <td>${this.formatPersianNumber(item.totalPrice)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="amount-box">
                <div class="amount-title">ŸÖÿ®ŸÑÿ∫ ⁄©ŸÑ ŸÇÿßÿ®ŸÑ Ÿæÿ±ÿØÿßÿÆÿ™</div>
                <div class="amount-value">${this.formatPersianNumber(invoiceData.totalAmount)} ÿ™ŸàŸÖÿßŸÜ</div>
            </div>
            
            <div class="formal-footer">
                <p><strong>ÿ¥ÿ±ÿß€åÿ∑ Ÿà ÿ∂Ÿàÿßÿ®ÿ∑:</strong></p>
                <p>‚Ä¢ ⁄©ŸÑ€åŸá ÿÆÿØŸÖÿßÿ™ ÿ∑ÿ®ŸÇ ŸÇŸàÿßŸÜ€åŸÜ ÿ¨ŸÖŸáŸàÿ±€å ÿßÿ≥ŸÑÿßŸÖ€å ÿß€åÿ±ÿßŸÜ ÿßÿ±ÿßÿ¶Ÿá ŸÖ€å‚Äå⁄Øÿ±ÿØÿØ</p>
                <p>‚Ä¢ ŸÖÿØÿ™ ÿßÿπÿ™ÿ®ÿßÿ± ŸÅÿß⁄©ÿ™Ÿàÿ± €≥€∞ ÿ±Ÿàÿ≤ ÿßÿ≤ ÿ™ÿßÿ±€åÿÆ ÿµÿØŸàÿ± ŸÖ€å‚Äåÿ®ÿßÿ¥ÿØ</p>
                <p>‚Ä¢ ÿØÿ± ÿµŸàÿ±ÿ™ ÿ®ÿ±Ÿàÿ≤ Ÿáÿ±⁄ØŸàŸÜŸá ŸÖÿ¥⁄©ŸÑ ÿ®ÿß ÿ¥ŸÖÿßÿ±Ÿá Ÿæÿ¥ÿ™€åÿ®ÿßŸÜ€å ÿ™ŸÖÿßÿ≥ ÿ≠ÿßÿµŸÑ ŸÅÿ±ŸÖÿß€å€åÿØ</p>
                
                <div class="signature-section">
                    <div class="signature-box">
                        <div class="signature-title">ŸÖŸáÿ± Ÿà ÿßŸÖÿ∂ÿß€å ŸÅÿ±Ÿàÿ¥ŸÜÿØŸá</div>
                    </div>
                    <div class="signature-box">
                        <div class="signature-title">ÿßŸÖÿ∂ÿß€å ÿÆÿ±€åÿØÿßÿ±</div>
                    </div>
                </div>
            </div>
        </div>
    </body>
    </html>
    `;
  }

  /**
   * Algorithm 3: Calligraphy Enhanced (Persian Optimized)
   * Uses Persian artistic elements, decorative borders, and cultural design
   */
  private generatePersianOptimizedTemplate(invoiceData: any): string {
    const config = this.TEMPLATE_CONFIGS['persian_optimized'];
    
    return `
    <!DOCTYPE html>
    <html lang="fa" dir="rtl">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ŸÅÿß⁄©ÿ™Ÿàÿ± ŸÅÿßÿ±ÿ≥€å ${invoiceData.invoiceNumber}</title>
        <style>
            @import url('https://cdn.jsdelivr.net/gh/rastikerdar/sahel-font@v3.4.0/dist/font-face.css');
            @import url('https://cdn.jsdelivr.net/gh/rastikerdar/samim-font@v4.0.5/dist/font-face.css');
            
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            
            body {
                font-family: 'Sahel', 'Samim', Tahoma, sans-serif;
                background: radial-gradient(circle at center, ${config.colors.background} 0%, #f0f9f0 100%);
                padding: 2rem;
                color: ${config.colors.text};
                line-height: 1.8;
            }
            
            .persian-invoice {
                max-width: 850px;
                margin: 0 auto;
                background: white;
                border-radius: 25px;
                overflow: hidden;
                box-shadow: 0 20px 50px rgba(0,0,0,0.15);
                border: 3px solid ${config.colors.primary};
                position: relative;
            }
            
            .persian-invoice::before {
                content: '';
                position: absolute;
                top: 0;
                right: 0;
                width: 150px;
                height: 150px;
                background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M50 10 L90 50 L50 90 L10 50 Z" fill="%23059669" opacity="0.1"/></svg>');
                background-size: contain;
                z-index: 1;
            }
            
            .artistic-header {
                background: linear-gradient(135deg, ${config.colors.primary} 0%, #34d399 50%, ${config.colors.accent} 100%);
                padding: 3rem 2rem;
                text-align: center;
                position: relative;
                overflow: hidden;
            }
            
            .artistic-header::after {
                content: '';
                position: absolute;
                bottom: -2px;
                left: 0;
                right: 0;
                height: 20px;
                background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 20"><path d="M0 20 Q25 0 50 10 T100 20 Z" fill="white"/></svg>');
                background-size: 100px 20px;
                background-repeat: repeat-x;
            }
            
            .company-persian-name {
                font-size: 3rem;
                font-weight: bold;
                color: white;
                text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
                margin-bottom: 1rem;
                font-family: 'Sahel', serif;
                letter-spacing: 2px;
            }
            
            .persian-slogan {
                font-size: 1.4rem;
                color: rgba(255,255,255,0.9);
                font-style: italic;
                margin-bottom: 1rem;
            }
            
            .decorative-divider {
                width: 200px;
                height: 3px;
                background: linear-gradient(90deg, transparent 0%, white 50%, transparent 100%);
                margin: 1rem auto;
            }
            
            .invoice-badge {
                background: white;
                color: ${config.colors.primary};
                padding: 1rem 2rem;
                border-radius: 50px;
                font-weight: bold;
                font-size: 1.2rem;
                display: inline-block;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            }
            
            .artistic-content {
                padding: 3rem 2rem;
                position: relative;
                z-index: 2;
            }
            
            .persian-section {
                background: ${config.colors.secondary};
                border: 2px solid ${config.colors.primary};
                border-radius: 20px;
                margin: 2rem 0;
                overflow: hidden;
                position: relative;
            }
            
            .persian-section::before {
                content: '';
                position: absolute;
                top: -10px;
                right: -10px;
                width: 40px;
                height: 40px;
                background: ${config.colors.accent};
                border-radius: 50%;
                opacity: 0.2;
            }
            
            .section-title-persian {
                background: linear-gradient(135deg, ${config.colors.primary} 0%, ${config.colors.accent} 100%);
                color: white;
                padding: 1.5rem 2rem;
                font-size: 1.4rem;
                font-weight: bold;
                text-align: center;
                position: relative;
            }
            
            .section-title-persian::after {
                content: 'üé≠';
                position: absolute;
                right: 2rem;
                top: 50%;
                transform: translateY(-50%);
                font-size: 1.2rem;
            }
            
            .persian-table {
                width: 100%;
                border-collapse: separate;
                border-spacing: 0;
                margin: 1.5rem 0;
                border-radius: 15px;
                overflow: hidden;
                box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            }
            
            .persian-table th {
                background: linear-gradient(135deg, ${config.colors.primary} 0%, #34d399 100%);
                color: white;
                padding: 1.5rem;
                font-weight: bold;
                text-align: center;
                position: relative;
            }
            
            .persian-table th::after {
                content: '';
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                height: 3px;
                background: ${config.colors.accent};
            }
            
            .persian-table td {
                padding: 1.5rem;
                text-align: center;
                background: white;
                border-bottom: 1px solid rgba(5,150,105,0.1);
                transition: all 0.3s ease;
            }
            
            .persian-table tr:hover td {
                background: ${config.colors.secondary};
                transform: scale(1.02);
            }
            
            .persian-table tr:last-child td {
                border-bottom: none;
            }
            
            .total-container-persian {
                background: linear-gradient(135deg, ${config.colors.primary} 0%, ${config.colors.accent} 100%);
                border-radius: 25px;
                padding: 3rem;
                margin: 2rem 0;
                text-align: center;
                color: white;
                position: relative;
                overflow: hidden;
            }
            
            .total-container-persian::before {
                content: 'üíé';
                position: absolute;
                top: 1rem;
                right: 2rem;
                font-size: 2rem;
                opacity: 0.3;
            }
            
            .total-persian-title {
                font-size: 1.5rem;
                margin-bottom: 1rem;
                opacity: 0.9;
            }
            
            .total-persian-amount {
                font-size: 3rem;
                font-weight: bold;
                text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
                margin-bottom: 1rem;
            }
            
            .total-persian-subtitle {
                font-size: 1.1rem;
                opacity: 0.8;
            }
            
            .artistic-footer {
                background: ${config.colors.secondary};
                padding: 2rem;
                text-align: center;
                border-top: 3px solid ${config.colors.primary};
                position: relative;
            }
            
            .persian-poem {
                font-style: italic;
                font-size: 1.1rem;
                color: ${config.colors.primary};
                margin-bottom: 1rem;
                line-height: 2;
            }
            
            .cultural-elements {
                display: flex;
                justify-content: center;
                gap: 2rem;
                margin-top: 2rem;
            }
            
            .cultural-item {
                text-align: center;
                padding: 1rem;
                border-radius: 15px;
                background: white;
                box-shadow: 0 4px 10px rgba(0,0,0,0.1);
                min-width: 120px;
            }
            
            .cultural-icon {
                font-size: 2rem;
                margin-bottom: 0.5rem;
            }
            
            @media print {
                body { padding: 0; background: white; }
                .persian-invoice { box-shadow: none; }
            }
        </style>
    </head>
    <body>
        <div class="persian-invoice">
            <div class="artistic-header">
                <div class="company-persian-name">ŸÖÿßÿ±ŸÅÿßŸÜÿ™</div>
                <div class="persian-slogan">ŸÅŸÜÿßŸàÿ±€å ÿØÿ± ÿÆÿØŸÖÿ™ ÿß€åÿ±ÿßŸÜ€åÿßŸÜ ÿπÿ≤€åÿ≤</div>
                <div class="decorative-divider"></div>
                <div class="invoice-badge">ŸÅÿß⁄©ÿ™Ÿàÿ± ÿ¥ŸÖÿßÿ±Ÿá ${invoiceData.invoiceNumber}</div>
            </div>
            
            <div class="artistic-content">
                <div class="persian-section">
                    <div class="section-title-persian">ÿßÿ∑ŸÑÿßÿπÿßÿ™ ŸÖÿ¥ÿ™ÿ±€å ⁄Øÿ±ÿßŸÖ€å</div>
                    <div style="padding: 2rem;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                            <div>
                                <strong>ŸÜÿßŸÖ ⁄©ÿßŸÖŸÑ:</strong><br>
                                <span style="font-size: 1.2rem; color: ${config.colors.primary};">
                                    ${invoiceData.representative?.fullName || 'ŸÖÿ¥ÿ™ÿ±€å ⁄Øÿ±ÿßŸÖ€å'}
                                </span>
                            </div>
                            <div>
                                <strong>ÿ™ÿßÿ±€åÿÆ ÿµÿØŸàÿ±:</strong><br>
                                <span style="font-size: 1.2rem; color: ${config.colors.accent};">
                                    ${this.getCurrentShamsiDate()}
                                </span>
                            </div>
                            <div>
                                <strong>ÿ¥ŸÖÿßÿ±Ÿá ÿ™ŸÖÿßÿ≥:</strong><br>
                                <span style="direction: ltr;">${invoiceData.representative?.phoneNumber || 'ÿ™ÿπÿ±€åŸÅ ŸÜÿ¥ÿØŸá'}</span>
                            </div>
                            <div>
                                <strong>ŸÜÿßŸÖ ŸÅÿ±Ÿàÿ¥⁄ØÿßŸá:</strong><br>
                                ${invoiceData.representative?.storeName || 'ÿ™ÿπÿ±€åŸÅ ŸÜÿ¥ÿØŸá'}
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="persian-section">
                    <div class="section-title-persian">ŸÖÿ¥ÿÆÿµÿßÿ™ ÿÆÿØŸÖÿßÿ™ ÿßÿ±ÿßÿ¶Ÿá ÿ¥ÿØŸá</div>
                    <div style="padding: 1rem;">
                        <table class="persian-table">
                            <thead>
                                <tr>
                                    <th>ÿ¥ÿ±ÿ≠ ÿÆÿØŸÖÿßÿ™</th>
                                    <th>ŸÖŸÇÿØÿßÿ±</th>
                                    <th>ŸÇ€åŸÖÿ™ Ÿàÿßÿ≠ÿØ</th>
                                    <th>ŸÖÿ®ŸÑÿ∫ ⁄©ŸÑ</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${invoiceData.items.map((item: any) => `
                                    <tr>
                                        <td style="text-align: right; font-weight: 500;">${item.description}</td>
                                        <td>${this.formatPersianNumber(item.quantity)}</td>
                                        <td>${this.formatPersianNumber(item.unitPrice)} ÿ™ŸàŸÖÿßŸÜ</td>
                                        <td style="font-weight: bold; color: ${config.colors.primary};">
                                            ${this.formatPersianNumber(item.totalPrice)} ÿ™ŸàŸÖÿßŸÜ
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="total-container-persian">
                    <div class="total-persian-title">ŸÖÿ®ŸÑÿ∫ ⁄©ŸÑ ŸÇÿßÿ®ŸÑ Ÿæÿ±ÿØÿßÿÆÿ™</div>
                    <div class="total-persian-amount">${this.formatPersianNumber(invoiceData.totalAmount)} ÿ™ŸàŸÖÿßŸÜ</div>
                    <div class="total-persian-subtitle">ÿ®ÿß ÿ™ÿ¥⁄©ÿ± ÿßÿ≤ ÿßÿπÿ™ŸÖÿßÿØ ÿ¥ŸÖÿß</div>
                </div>
            </div>
            
            <div class="artistic-footer">
                <div class="persian-poem">
                    "ÿØÿ± ÿ±ÿßŸá ÿÆÿØŸÖÿ™ ÿ®Ÿá ŸáŸÖŸàÿ∑ŸÜÿßŸÜ ÿπÿ≤€åÿ≤<br>
                    ŸÖÿßÿ±ŸÅÿßŸÜÿ™ ŸáŸÖŸàÿßÿ±Ÿá ÿØÿ± ⁄©ŸÜÿßÿ± ÿ¥ŸÖÿßÿ≥ÿ™"
                </div>
                
                <div class="cultural-elements">
                    <div class="cultural-item">
                        <div class="cultural-icon">üåü</div>
                        <div>⁄©€åŸÅ€åÿ™ ÿ®ÿ±ÿ™ÿ±</div>
                    </div>
                    <div class="cultural-item">
                        <div class="cultural-icon">ü§ù</div>
                        <div>ÿßÿπÿ™ŸÖÿßÿØ ŸÖÿ™ŸÇÿßÿ®ŸÑ</div>
                    </div>
                    <div class="cultural-item">
                        <div class="cultural-icon">üöÄ</div>
                        <div>ŸÅŸÜÿßŸàÿ±€å ÿ±Ÿàÿ≤</div>
                    </div>
                </div>
                
                <p style="margin-top: 2rem; font-size: 0.9rem; opacity: 0.7;">
                    ÿß€åŸÜ ŸÅÿß⁄©ÿ™Ÿàÿ± ÿ∑ÿ®ŸÇ ŸÇŸàÿßŸÜ€åŸÜ ÿ™ÿ¨ÿßÿ±ÿ™ ÿßŸÑ⁄©ÿ™ÿ±ŸàŸÜ€å⁄© ÿß€åÿ±ÿßŸÜ ÿµÿßÿØÿ± ÿ¥ÿØŸá ÿßÿ≥ÿ™
                </p>
            </div>
        </div>
    </body>
    </html>
    `;
  }

  /**
   * Generate invoice based on selected template
   */
  public generateInvoice(invoiceData: any, templateType: string): string {
    switch (templateType) {
      case 'modern_clean':
        return this.generateModernCleanTemplate(invoiceData);
      case 'classic_formal':
        return this.generateClassicFormalTemplate(invoiceData);
      case 'persian_optimized':
        return this.generatePersianOptimizedTemplate(invoiceData);
      default:
        return this.generateModernCleanTemplate(invoiceData);
    }
  }

  /**
   * Get available templates
   */
  public getAvailableTemplates(): Record<string, TemplateConfig> {
    return this.TEMPLATE_CONFIGS;
  }

  /**
   * Format Persian numbers
   */
  private formatPersianNumber(num: string | number): string {
    const englishDigits = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];
    const persianDigits = ['€∞', '€±', '€≤', '€≥', '€¥', '€µ', '€∂', '€∑', '€∏', '€π'];
    
    return num.toString().replace(/[0-9]/g, (match) => {
      return persianDigits[englishDigits.indexOf(match)];
    });
  }

  /**
   * Get current Shamsi date
   */
  private getCurrentShamsiDate(): string {
    const now = new Date();
    const shamsiYear = now.getFullYear() - 621;
    const shamsiMonth = String(now.getMonth() + 1).padStart(2, '0');
    const shamsiDay = String(now.getDate()).padStart(2, '0');
    
    return this.formatPersianNumber(`${shamsiYear}/${shamsiMonth}/${shamsiDay}`);
  }
}

export const enhancedInvoiceTemplates = new EnhancedInvoiceTemplates();