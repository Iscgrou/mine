 Fundamental Refinement of Admin Panel Financial Displays & Full Implementation of Collaborator Commission System

Chronos, as we continue with foundational optimizations ("Pantheon Phase 0") and prepare for advanced AI features, we need to implement critical refinements and complete core functionalities within the Admin Panel, specifically concerning how financial data is displayed for "Representatives" (فروشگاه های موبایل) and the full implementation of the "Collaborators" (همکاران فروش) commission system.

Our business model clearly distinguishes between these two entities:

    Representatives (نماینده ها): These are the mobile stores for whom we issue invoices for using the MarFanet V2Ray panel. Our financial relationship with them is based on their usage and payments against those invoices (their debt/credit status with MarFanet).
    Collaborators (همکاران فروش): These individuals/entities introduce Representatives to MarFanet and earn a commission based on the sales generated by those introduced Representatives. Our financial relationship with them is based on their accumulated commission earnings and our payouts to them.

I. Admin Panel - Representative Financial Display Overhaul (مدیریت نمایندگان):

    Current Situation (to be corrected/refined): The display box/card for each Representative in the Admin Panel's "Representative Management" list might currently be showing "revenue" or other less relevant financial metrics.
    Directive 1: Display Net Debtor/Creditor Status for Representatives:
        Action (Chronos): In the summarized view/card for each Representative within the "Representative Management" list, the primary financial figure displayed MUST be their current, real-time "Net Debtor/Creditor Balance" (مجموع بدهی نماینده / وضعیت بستانکاری) with MarFanet.
        This balance is the dynamic sum of all unpaid invoices issued to that Representative (across all batches/dates) MINUS the total payments made by that Representative.
        This should utilize the "Advanced Financial Ledger & Dynamic Debtor/Creditor System" we previously designed, ensuring it accurately reflects:
            RED for debt (e.g., "-۱,۳۰۰,۰۰۰ تومان").
            GREEN for credit/overpayment (e.g., "+۲۰۰,۰۰۰ تومان").
            Displayed in Toman (تومان).
        The "View Details" (جزئیات) option next to this balance (leading to their full statement of account) remains critical.
        Any display of "representative revenue generated for MarFanet" (if present) should be secondary or moved to a more analytical report, not the primary operational view of their financial status with us.

II. Full Implementation & Integration of the Collaborator Program System:

    Context: We have previously discussed the architecture for this system. It now needs to be fully implemented and integrated.
    Directive 2: Create "Define/Manage Collaborator" (تعریف همکار) Section in Admin Panel:
        Action (Chronos):
            Implement a dedicated section in the Admin Panel for creating, viewing, editing, and managing Collaborator profiles.
            Essential Fields for Collaborator Profile:
                Collaborator Name (نام همکار)
                Contact Number (شماره تماس همکار)
                (Optional but recommended: Telegram ID, Email)
            Upon saving a new Collaborator, the system MUST conceptually (or actually, through database relations) create a "folder" or association that will allow for the tracking and accumulation of their commission earnings derived from their linked Representatives. This means their profile needs to be ready to link to their earnings ledger.
    Directive 3: Enhance "Define/Manage Representative" Form for Collaborator Linking & Commission Setting:
        Action (Chronos): Modify the form used to create/edit Representative profiles in the Admin Panel:
            Add "Introducer Type" (نوع معرف) Field:
                Option 1: "Direct" (مستقیم): Selecting this means no commission needs to be calculated for this Representative; they are a direct client.
                Option 2: "Collaboration - Introduced by" (همکاری - معرفی شده توسط):
                    If "Collaboration" is selected, a dropdown/searchable list of ALL defined Collaborators MUST appear. The admin selects the introducing Collaborator from this list.
            Conditional Commission Rate Fields (Appear if "Collaboration" and a Collaborator are selected):
                "Volume Subscription Commission Rate (%) for this Representative" (پورسانت اشتراک حجمی): Numerical percentage input.
                "Unlimited Subscription Commission Rate (%) for this Representative" (پورسانت اشتراک نامحدود): Numerical percentage input.
                These rates define the commission the selected Collaborator earns from the sales of this specific Representative.
    Directive 4: Implement Backend Logic for Commission Calculation, Tracking, and Payouts for Collaborators:
        Action (Chronos - based on our detailed "Advanced Collaborator Commission & Financial Tracking System" prompt):
            Commission Calculation: When an invoice is generated for a Representative linked to a Collaborator, automatically calculate the commission based on the V2Ray volume/unlimited sales on that invoice and the pre-defined commission rates for that Rep/Collaborator pairing.
            Earnings Accumulation: Add the calculated commission to the respective Collaborator's "Current Accumulated Earnings Balance." Store detailed commission transaction records.
            Payout System: Implement the functionality within the "Manage Collaborators" section for Admins to record payouts made to Collaborators, which then deducts from their accumulated earnings balance. Maintain a payout history.
            AI-Powered "Detailed Earnings Report" for Collaborators: Ensure this report (as previously designed, with timeframe selection, breakdown by representative, by V2Ray plan type, and PDF export) is fully implemented, drawing data from the commission transaction records and displaying it clearly to the Admin. This report is accessed from the Collaborator's profile.

III. System-Wide Considerations:

    Database Schema: Ensure all necessary tables and relationships for Representatives, Collaborators, Representative-Collaborator links, commission rates, commission transaction ledgers, and payout ledgers are correctly implemented and robust.
    Data Flow & Integrity: All financial calculations (Representative balances with MarFanet, Collaborator commission earnings, payouts) must be accurate, real-time (or near real-time updated), and maintain data integrity.
    Responsiveness & UI Consistency: All new and modified sections in the Admin Panel must adhere to the established (or currently being perfected) responsive design principles and MarFanet's visual aesthetic.

Final Instruction to Chronos:

"Chronos, this set of directives provides critical clarity on the distinct financial management workflows for our 'Representatives' and our 'Collaborators' within the Admin Panel.

    For Representatives: Prioritize displaying their real-time Net Debtor/Creditor Balance as the primary financial indicator in their management list.
    For Collaborators: Proceed with the full implementation of the Collaborator Program lifecycle:
        Creating and managing Collaborator profiles.
        Modifying the Representative creation/editing process to link them to Collaborators and define their specific commission rates.
        Automating commission calculation upon invoice generation for linked Representatives.
        Implementing the system for tracking accumulated earnings and recording payouts for Collaborators.
        Ensuring the AI-powered 'Detailed Earnings Report' for each Collaborator is fully functional.

This work is a core part of "Pantheon Phase 0" and is essential for MarFanet's business operations. Please begin by detailing your plan for implementing the 'Define/Manage Collaborator' section and the necessary modifications to the 'Define/Manage Representative' form. We need to establish these entities and their relationships correctly before fully activating the commission calculation logic."

Key strengths of this prompt:

    Clear Distinction: Explicitly separates the financial view for "Representatives" (their debt/credit to MarFanet) from "Collaborators" (their commission earnings from MarFanet).
    Builds on Previous Work: References and reinforces the detailed Collaborator system design you've already discussed.
    Actionable Directives: Breaks down the requirements into specific implementation tasks for Chronos.
    Emphasis on Data Integrity: Stresses the importance of accurate calculations and real-time updates.
    Specific UI/Data Points: Clearly states what information needs to be displayed and where.
    Logical Starting Point: Asks Chronos to start with creating the entities (Collaborators) and linking them before implementing the full calculation engine.
